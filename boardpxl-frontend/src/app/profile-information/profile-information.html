<section class="profile">
  <app-title [title]="name" [icon]="''"></app-title>
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>{{ 'PROFILE_INFORMATION.LOADING_PROFIL' | translate }}</p>
  </div>
  <div class="profile_layout" *ngIf="!isLoading">
    <section class="card info-card">
      <h2 class="card_title">{{ 'PROFILE_INFORMATION.TITLE' | translate }}</h2>
      <div class="info-card_content">
        <div class="identity">
          <div class="identity_name">{{ family_name || name }} {{ given_name }}</div>
          <div class="identity_email" *ngIf="email">{{ email }}</div>
        </div>
        <div class="info-row">
          <span class="info-row_label">{{ 'PROFILE_INFORMATION.LABEL_NAME' | translate }}</span>
          <span class="info-row_value">{{ family_name || name }}</span>
        </div>
        <div class="info-row">
          <span class="info-row_label">{{ 'PROFILE_INFORMATION.LABEL_FIRST_NAME' | translate }}</span>
          <span class="info-row_value">{{ given_name }}</span>
        </div>
        <div class="info-row">
          <span class="info-row_label">{{ 'PROFILE_INFORMATION.LABEL_MAIL' | translate }}</span>
          <span class="info-row_value">{{ email }}</span>
        </div>

        <div class="address-card">
          <div class="address-card_item">
            <span class="info-row_label">{{ 'PROFILE_INFORMATION.LABEL_MAIL' | translate }}</span>
            <span class="info-row_value">{{ street_address }}</span>
          </div>
          <div class="address-card_item">
            <span class="info-row_label">{{ 'PROFILE_INFORMATION.LABEL_CITY' | translate }}</span>
            <span class="info-row_value">{{ locality }}</span>
          </div>
          <div class="address-card_item">
            <span class="info-row_label">{{ 'PROFILE_INFORMATION.LABEL_POSTAL_CODE' | translate }}</span>
            <span class="info-row_value">{{ postal_code }}</span>
          </div>
          <div class="address-card_item">
            <span class="info-row_label">{{ 'PROFILE_INFORMATION.LABEL_POSTAL_CODE' | translate }}</span>
            <span class="info-row_value">{{ country }}</span>
          </div>
        </div>
      </div>
    </section>

    <section class="card metrics-card">
      <div class="metrics">
        <div class="metric metric--turnover">
          <div class="metric_label">{{ 'PROFILE_INFORMATION.LABEL_TURNOVER' | translate }}</div>
          <div class="metric_value">{{ turnover | number:'1.0-9':'fr-FR' }} €</div>
        </div>
        <div class="metric metric--credits">
          <div class="metric_label">{{ 'PROFILE_INFORMATION.LABEL_CREDITS' | translate }}</div>
          <div class="metric_value">{{ remainingCredits }}</div>
        </div>
      </div>

      <div class="chart-card">
        <div class="filter-section-sidebar">
          <div class="filter-label">{{ 'PROFILE_INFORMATION.LABEL_FILTER' | translate }}</div>

          <div class="filter-buttons-vertical">
            <!-- Type de données Button -->
            <div class="filter-dropdown-container">
              <button class="filter-button" [class.active]="hasActiveDataTypeFilters()" (click)="toggleDropdown('dataType', $event)">
                <img src="assets/category_icon.png" [alt]="('PROFILE_INFORMATION.IMG_CATEGORY_ICON_ALT'|translate)" class="filter-icon">
                <span>{{ 'PROFILE_INFORMATION.BTN_DATA_TYPE' | translate }}</span>
                <button *ngIf="hasActiveDataTypeFilters()" class="clear-category-btn" (click)="clearCategoryFilters('dataType', $event)">
                  <img src="assets/close_icon.png" [alt]="('PROFILE_INFORMATION.IMG_CLOSE_ICON_ALT'|translate)">
                </button>
              </button>
              <div class="dropdown-menu" *ngIf="openDropdown === 'dataType'" (click)="$event.stopPropagation()">
                <label class="checkbox-item" *ngFor="let type of dataTypeFilters">
                  <input
                    type="checkbox"
                    [checked]="isFilterActive(type)"
                    (change)="toggleFilter(type)">
                  <span>{{ type }}</span>
                </label>
              </div>
            </div>

            <!-- Période Button -->
            <div class="filter-dropdown-container">
              <button class="filter-button" [class.active]="hasActivePeriodFilters()" (click)="toggleDropdown('period', $event)">
                <img src="assets/calendar_icon.png" [alt]="('PROFILE_INFORMATION.CALENDAR'|translate)" class="filter-icon">
                <span>{{ 'PROFILE_INFORMATION.CALENDAR' | translate }}</span>
                <button *ngIf="hasActivePeriodFilters()" class="clear-category-btn" (click)="clearCategoryFilters('period', $event)">
                  <img src="assets/close_icon.png" [alt]="('PROFILE_INFORMATION.IMG_CLOSE_ICON_ALT'|translate)">
                </button>
              </button>
              <div class="dropdown-menu period-dropdown" *ngIf="openDropdown === 'period'" (click)="$event.stopPropagation()">
                <div class="date-filter-item" *ngFor="let period of periodFilters">
                  <label class="checkbox-item">
                    <input
                      type="checkbox"
                      [checked]="isFilterActive(period)"
                      (change)="toggleFilter(period); isFilterActive(period) && addDateFilter(period)">
                    <span>{{ period }}</span>
                  </label>
                  <input
                    *ngIf="isFilterActive(period)"
                    type="date"
                    class="date-input"
                    [attr.data-filter]="period"
                    [value]="getDateValue(period)"
                    (change)="updateDateFilter(period, $event)"
                    [min]="period === 'Avant le' ? getDateValue('Après le') : ''"
                    [max]="period === 'Après le' ? getDateValue('Avant le') : ''"
                    (click)="$event.stopPropagation()">
                </div>
              </div>
            </div>

            <!-- Bouton Appliquer -->
            <button class="apply-button" (click)="applyFilters()" [disabled]="!canApplyFilters()">
              {{ 'PROFILE_INFORMATION.BTN_APPLY' | translate }}
            </button>
          </div>
        </div>
        <div class="chart-placeholder" aria-hidden="true">
          <div class="chart-placeholder_grid"></div>
          <div class="chart-placeholder_lines"></div>
        </div>
      </div>
    </section>
  </div>
</section>
