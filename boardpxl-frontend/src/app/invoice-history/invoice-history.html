<div class="container">
    <div class="header">
        <p>Historique des factures</p>
        <div class="filter-section">
            <span class="filter-label">Filtres</span>
            
            <!-- Active filters display -->
            <div class="active-filters" *ngIf="activeFilters.length > 0">
                <div class="filter-tag" *ngFor="let filter of activeFilters">
                    <button class="remove-filter" (click)="removeFilter(filter)">
                        <img src="assets/close_icon.png" alt="Retirer le filtre">
                    </button>
                    <span class="filter-tag-label" *ngIf="!isDateFilter(filter)">{{ filter }}</span>
                    <ng-container *ngIf="isDateFilter(filter)">
                        <span class="filter-tag-label">{{ filter }} :</span>
                        <input 
                            type="date" 
                            class="date-input"
                            [value]="getDateValue(filter)"
                            [max]="filter === 'Après le' ? getDateValue('Avant le') : null"
                            [min]="filter === 'Avant le' ? getDateValue('Après le') : null"
                            (change)="updateDateFilter(filter, $event)"
                            #dateInput>
                    </ng-container>
                </div>
            </div>

            <button class="filter-button" (click)="toggleFilterModal($event)">
                <img src="assets/add_icon.png" alt="Ajouter un filtre">
            </button>
            
            <!-- Filter Modal -->
            <div class="filter-modal" *ngIf="isFilterModalOpen" (click)="$event.stopPropagation()">
                <!-- Main filter menu -->
                <div *ngIf="!selectedFilterType">
                    <h3 class="modal-title">Options de recherche</h3>
                    <button class="filter-option" 
                            [class.disabled]="!hasAvailableStatusFilters()"
                            [disabled]="!hasAvailableStatusFilters()"
                            (click)="openFilterType('status')">
                        <span class="option-text">Statut : <span class="option-values">Payée, Non payée, En attente</span></span>
                        <span class="plus-sign">+</span>
                    </button>
                    <button class="filter-option" 
                            [class.disabled]="!hasAvailableTypeFilters()"
                            [disabled]="!hasAvailableTypeFilters()"
                            (click)="openFilterType('type')">
                        <span class="option-text">Type : <span class="option-values">Achat de crédits, Versement</span></span>
                        <span class="plus-sign">+</span>
                    </button>
                    <button class="filter-option" (click)="openFilterType('period')">
                        <span class="option-text">Période : <span class="option-values">Date de début, Date de fin</span></span>
                        <span class="plus-sign">+</span>
                    </button>
                </div>

                <!-- Status filter submenu -->
                <div *ngIf="selectedFilterType === 'status'">
                    <button class="back-button" (click)="goBack()">← Retour</button>
                    <h3 class="modal-title">Statut</h3>
                    <button class="filter-option" 
                            [class.disabled]="isFilterActive('Payée')"
                            [disabled]="isFilterActive('Payée')"
                            (click)="addFilter('Payée')">
                        <span class="option-text">Payée</span>
                        <span class="plus-sign">+</span>
                    </button>
                    <button class="filter-option" 
                            [class.disabled]="isFilterActive('Non payée')"
                            [disabled]="isFilterActive('Non payée')"
                            (click)="addFilter('Non payée')">
                        <span class="option-text">Non payée</span>
                        <span class="plus-sign">+</span>
                    </button>
                    <button class="filter-option" 
                            [class.disabled]="isFilterActive('En retard')"
                            [disabled]="isFilterActive('En retard')"
                            (click)="addFilter('En retard')">
                        <span class="option-text">En retard</span>
                        <span class="plus-sign">+</span>
                    </button>
                </div>

                <!-- Type filter submenu -->
                <div *ngIf="selectedFilterType === 'type'">
                    <button class="back-button" (click)="goBack()">← Retour</button>
                    <h3 class="modal-title">Type</h3>
                    <button class="filter-option" 
                            [class.disabled]="isFilterActive('Achat de crédits')"
                            [disabled]="isFilterActive('Achat de crédits')"
                            (click)="addFilter('Achat de crédits')">
                        <span class="option-text">Achat de crédits</span>
                        <span class="plus-sign">+</span>
                    </button>
                    <button class="filter-option" 
                            [class.disabled]="isFilterActive('Versement')"
                            [disabled]="isFilterActive('Versement')"
                            (click)="addFilter('Versement')">
                        <span class="option-text">Versement</span>
                        <span class="plus-sign">+</span>
                    </button>
                </div>

                <!-- Period filter submenu -->
                <div *ngIf="selectedFilterType === 'period'">
                    <button class="back-button" (click)="goBack()">← Retour</button>
                    <h3 class="modal-title">Période</h3>
                    <button class="filter-option"
                            [class.disabled]="isFilterActive('Après le')"
                            [disabled]="isFilterActive('Après le')"
                            (click)="addDateFilter('Après le')">
                        <span class="option-text">Date de début : <span class="option-values">Après le</span></span>                        
                        <span class="plus-sign">+</span>
                    </button>
                    <button class="filter-option"
                            [class.disabled]="isFilterActive('Avant le')"
                            [disabled]="isFilterActive('Avant le')"
                            (click)="addDateFilter('Avant le')">
                        <span class="option-text">Date de fin : <span class="option-values">Avant le</span></span>                        
                        <span class="plus-sign">+</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="invoice-list">
        <div class="invoice-item" *ngFor="let invoice of invoices">
            <app-invoice-card [invoice]="invoice"></app-invoice-card>
        </div>
    </div>
</div>
